/******************************************************************************/
/*   M Q   E V E N T S                                     */
/*                                                                    */
/*    Worker functions:                              */
/*      - xymonWorker                                      */
/*      - consoleWorker                                */
/*      - initMq                        */
/*                                                        */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <cmqc.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include "cmdln.h"
#include <inihnd.h>
#include <ctl.h>
#include <msgcat/lgstd.h>

#include <mqbase.h>

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/
int initMq( ) ;

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*  xymon worker                                    */
/******************************************************************************/
int xymonWorker( )
{
  logFuncCall( ) ;

  int sysRc = 0 ;

#if(0)
  _door :
#endif
  logFuncExit( ) ;

  return sysRc ;
}

/******************************************************************************/
/*  console worker                                  */
/******************************************************************************/
int consoleWorker()
{
  logFuncCall( ) ;

  int sysRc = 0 ;

  initMq();

#if(0)
  _door :
#endif
  logFuncExit( ) ;
  return sysRc ;
}

/******************************************************************************/
/* init mq connection                        */
/******************************************************************************/
int initMq( )
{
  logFuncCall( ) ;

  tIniNode *searchIni ;

  MQLONG sysRc = MQRC_NONE ;
  MQHCONN hConn ;

  // -------------------------------------------------------
  // connect to qmgr
  // -------------------------------------------------------
  char *qmgr = getStrAttr( "qmgr" );         // try to get qmgr name from cmdln
  if( qmgr == NULL )                         // if no qmgr name on cmdln 
  {                                          // try to get it from the ini file
     qmgr = getIniStrValue( getIniNode("mq","qmgr"), name ); 
  }                                          //
                                             // if no qmgr on cmdln or ini
  sysRc = mqConn( qmgr, &hConn );            //   use default qmgr (qmgr==NULL)
  switch( sysRc )                            // connect to qmgr 
  {                                          //
    case MQRC_NONE : break ;                 // connect ok
    default        : goto _door ;            // connect failed
  }                                          //
                                             //
  // -------------------------------------------------------
  // open queue
  // -------------------------------------------------------
  

  _door :

  logFuncExit( ) ;

  return sysRc ;
}
