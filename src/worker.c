/******************************************************************************/
/*   M Q   E V E N T S                                                        */
/*                                                                            */
/*    Worker functions:                                        */
/*      - xymonWorker                                                */
/*      - consoleWorker                                          */
/*      - htmlWorker                          */
/*      - ackWorker                    */
/*                                                          */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <cmqc.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include "cmdln.h"
#include <inihnd.h>
#include <ctl.h>
#include <msgcat/lgstd.h>
#include <mqbase.h>
#include <worker.h>

// ---------------------------------------------------------
// local
// ---------------------------------------------------------
#include <mqev.h>
#include <dumper.h>

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*  xymon worker                                                */
/******************************************************************************/
int xymonWorker( )
{
  logFuncCall( ) ;

  int sysRc = 0 ;

#if(0)
  _door :
#endif
  logFuncExit( ) ;

  return sysRc ;
}

/******************************************************************************/
/*  console worker                                              */
/******************************************************************************/
int consoleWorker()
{
  logFuncCall( ) ;

  int sysRc = 0 ;

  sysRc = initMq();
  if( sysRc != 0 )
  {
    goto _door ;
  }

  // -------------------------------------------------------
  // browse messages in input queue
  // -------------------------------------------------------
  browseEvents();

  handleDoneEvents();

  // -------------------------------------------------------
  // list events
  // -------------------------------------------------------
  printAllEventList();

  _door :

  logFuncExit( ) ;
  return sysRc ;
}


/******************************************************************************/
/*  html worker                        */
/******************************************************************************/
int htmlWorker()
{
  logFuncCall( ) ;
  int sysRc = 0 ;

  tIniNode *searchIni ;    // data structure for getting searching in ini files
  char     *wwwDir    ;    // directory for raw html data

  searchIni = getIniNode( "system", "html" );  // system.html node from ini
  wwwDir = getIniStrValue( searchIni,"dir" );  // get file & level from node
  if( !wwwDir )
  {
    sysRc = 1;
    goto _door;
  }

  sysRc = initMq();
  if( sysRc != 0 )
  { 
    goto _door ;
  }

  // -------------------------------------------------------
  // browse messages in input queue
  // -------------------------------------------------------
  browseEvents();

  // -------------------------------------------------------
  // list events on html
  // -------------------------------------------------------
  sysRc = printAllEventTable( wwwDir );
  if( sysRc != 0 )
  {
    goto _door;
  }

  _door :

  logFuncExit( ) ;
  return sysRc ;
}

/******************************************************************************/
/*  acknowledge worker      */
/******************************************************************************/
int ackWorker( )
{
  logFuncCall( ) ;
  int sysRc = 0 ;

  char** msgIdArr    ;
  int    msgIdArrSize;

  msgIdArr = getStrArrayAttr( "ack" );  // get all message id's from 
                                        //   the command line
  if( !msgIdArr )                       // already checked in main 
  {                                     //   message id is not NULL
    goto _door;                      //
  }                              //
                                        //
  msgIdArrSize = getAttrSize( "ack" );  // get the nr of message id's
                                    //

  _door :      // 

  logFuncExit( ) ;
  return sysRc ;
}
