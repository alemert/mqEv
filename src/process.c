/******************************************************************************/
/*            M Q   E V E N T   -   P R O C E S S   H A N D L E R             */
/*                                                                        */
/*  Description:                                             */
/*    function handling signals, and stopping the application            */
/*                                                      */
/*  Functions:                                          */
/*   - setSignals                          */
/*   - bye                                    */
/*   - quit                              */
/*   - checkSignal                    */
/*                                            */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <stdlib.h>
#include <signal.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include <ctl.h>
#include <msgcat/lgstd.h>

// ---------------------------------------------------------
// local
// ---------------------------------------------------------
#include <mqev.h>

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/
const char* _gPrgName ;
int _gSignalFlag = 0;

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/
void bye();
void quit();

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/
void setSignals( const char* prg )
{
  logFuncCall( ) ;

  _gPrgName = prg ;

  atexit( endMq );
  atexit( bye );
  signal( SIGINT, quit );

  logFuncExit( ) ;
}

/******************************************************************************/
/*  at exit functions              */
/******************************************************************************/
void bye( )
{
  logFuncCall( ) ;
  logger(LSTD_PRG_STOP, _gPrgName );
  logFuncExit( ) ;
}

/******************************************************************************/
/*  signal functions              */
/******************************************************************************/
void quit()
{
  _gSignalFlag = SIGINT;
  logFuncCall( ) ;
  exit(0);
}

/******************************************************************************/
/* check signal            */
/******************************************************************************/
int checkSignal()
{
  return _gSignalFlag;
}


