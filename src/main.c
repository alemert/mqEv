/******************************************************************************/
/*                             M Q   E V E N T S                              */
/*                                                            */
/*  description:                                  */
/*    start program :                                */
/*      from cmd line                          */
/*      triggered from qmgr                      */
/*    read (browse) mq events from some event queue            */
/*    analyse the event                                  */
/*    show event on the console or send it to the xymon            */
/*    rotate monitoring                              */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <libgen.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include "main.h"

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/
int initPrg( int argc, const char* argv[] ) ;

/******************************************************************************/
/*                                                                            */
/*                                  M A I N                                   */
/*                                                                            */
/******************************************************************************/
#ifndef __TDD__

int main(int argc, const char* argv[] )
{
  int sysRc ;

  // -------------------------------------------------------
  // init program 
  // -------------------------------------------------------
  sysRc = initPrg( argc, argv );  // get command line, setup logging
  if( sysRc != 0 ) goto _door;   

  // -------------------------------------------------------
  // main work
  // -------------------------------------------------------
  sysRc = worker( );
  if( sysRc != 0 ) goto _door;   

_door :

  return sysRc ;
}

#endif

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*  init program                                                */
/*    - analyse cmdln attributes                                */
/*    - setup logging                                    */
/******************************************************************************/
int initPrg( int argc, const char* argv[] )
{
  int sysRc ;

  // -------------------------------------------------------
  // handle command line
  // -------------------------------------------------------
  sysRc = handleCmdLn( argc, argv ) ;
  if( sysRc != 0 ) goto _door ;

  const char *logName = getStrAttr( "log" ) ;
  if( logName == NULL ) ;

  // -------------------------------------------------------
  // set logging
  // -------------------------------------------------------
  sysRc = initLogging( "var/log/main.log", INF ) ;
  if( sysRc != 0 ) goto _door ;

  logger( LSTD_PRG_START, basename( (char*) argv[0] ) ) ;
  
_door :
  return sysRc ;
}


